# Template file for 'gprbuild'
pkgname=gprbuild
version=25.0.0
revision=1
build_style=gnu-configure
short_desc="Advanced build system for multi-language programs"
maintainer="Estevan Castilho <estevan.cps@gmail.com>"
license=GPL-3.0-or-later
homepage="https://github.com/AdaCore/gprbuild"
distfiles="https://github.com/AdaCore/gprbuild/archive/refs/tags/v${version}.tar.gz"
checksum="d12f94c1ec0b6e219f6b162f71f57129d22426e7798092f5f85b9ec2cc818bf1"

hostmakedepends="gcc-ada gprbuild-bootstrap which"
makedepends="xmlada-devel"
depends="gprconfig_kb"

subpackages="libgpr libgpr-devel"

make_build_target="all libgpr.build"
make_install_target="install libgpr.install"

do_configure() {
	make prefix="$DESTDIR/usr" setup
}

libgpr_package() {
	license+=" WITH GCC-exception-3.1"
	short_desc+=" - library"
	depends="${sourcepkg}>=${version}_${revision}"
	pkg_install() {
		cd "$DESTDIR"
		# vmove isn't the biggest fan of globs on parent directories
		for file in usr/lib/gpr/*/*/*.so*; do
			vmove "$file"
		done
	}
}

libgpr-devel_package() {
	license+=" WITH GCC-exception-3.1"
	short_desc+=" - library - development files"
	depends="libgpr>=${version}_${revision}"
	pkg_install() {
		vmove "usr/lib/*.so"
		vmove usr/lib/gpr
		vmove usr/share/gpr
		vmove usr/include
	}
}
